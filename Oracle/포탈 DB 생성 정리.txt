==============================
포탈 DB 구성 순서
==============================
1. DB 생성
su - oraUAP
export ORACLE_SID=GWIDEDEV
sqlplus "/as sysdba"
아래 쿼리 조회 해서 생성된 SID 와 DATAFILE 리스트 확인
SELECT INSTANCE_NAME, STATUS, DATABASE_STATUS FROM V$INSTANCE;
SELECT * FROM GLOBAL_NAME;
SELECT NAME FROM V$DATAFILE;
dbca -silent -createDatabase -templateName General_Purpose.dbc -gdbname GWIDEDEV -sid GWIDEDEV -sysDBAUserName sys -sysDBAPassword password -responseFile NO_VALUE -characterSet AL32UTF8 -memoryPercentage 20 -emConfiguration NONE

2. 테이블스 페이스 추가
CREATE TABLESPACE DATA01 DATAFILE '/ORACLE/oradata/GWIDEDEV/data01.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE DATA02 DATAFILE '/ORACLE/oradata/GWIDEDEV/data02.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE DATA03 DATAFILE '/ORACLE/oradata/GWIDEDEV/data03.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE DATA04 DATAFILE '/ORACLE/oradata/GWIDEDEV/data04.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;

CREATE TABLESPACE INDEX01 DATAFILE '/ORACLE/oradata/GWIDEDEV/index01.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE INDEX02 DATAFILE '/ORACLE/oradata/GWIDEDEV/index02.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE INDEX03 DATAFILE '/ORACLE/oradata/GWIDEDEV/index03.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE INDEX04 DATAFILE '/ORACLE/oradata/GWIDEDEV/index04.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;

CREATE TABLESPACE TS_MWADM DATAFILE '/ORACLE/oradata/GWIDEDEV/ts_mwadm.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE BIG_IDX DATAFILE '/ORACLE/oradata/GWIDEDEV/big_idx.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;
CREATE TABLESPACE BIG_DATA DATAFILE '/ORACLE/oradata/GWIDEDEV/big_data.dbf' SIZE 64M AUTOEXTEND ON SEGMENT SPACE MANAGEMENT AUTO;

3. 사용자 추가
CREATE USER GAEBAL_UPADM IDENTIFIED BY gaebal_upadm DEFAULT TABLESPACE DATA01 ;
GRANT CONNECT, RESOURCE, DBA TO GAEBAL_UPADM;

CONNECT GAEBAL_UPADM

sqlplus 접속한 폴더에 아래 파일들 놓고 실행
@SEQUENCE_DDL.SQL
@TABLE_DDL.SQL
@INDEX_DDL.SQL
@FUNCTION_DDL.SQL
@PROCEDURE_DDL.SQL

==============================
포탈 DB 원복 순서
==============================
SET SERVEROUTPUT ON;
BEGIN
    FOR C IN (SELECT * FROM USER_OBJECTS ORDER BY OBJECT_TYPE) LOOP
        IF (C.OBJECT_TYPE = 'SEQUENCE') THEN
            DBMS_OUTPUT.PUT_LINE(C.OBJECT_NAME);
            --DBMS_OUTPUT.PUT_LINE('DROP SEQUENCE GAEBAL_UPADM.'||C.OBJECT_NAME);
            EXECUTE IMMEDIATE 'DROP SEQUENCE GAEBAL_UPADM.'||C.OBJECT_NAME;
        ELSIF (C.OBJECT_TYPE = 'TABLE') THEN
            DBMS_OUTPUT.PUT_LINE(C.OBJECT_NAME);
            --DBMS_OUTPUT.PUT_LINE('DROP TABLE GAEBAL_UPADM.'||C.OBJECT_NAME||' CASCADE CONSTRAINTS PURGE');
            EXECUTE IMMEDIATE 'DROP TABLE GAEBAL_UPADM.'||C.OBJECT_NAME||' CASCADE CONSTRAINTS PURGE';
        ELSIF (C.OBJECT_TYPE = 'FUNCTION') THEN
            DBMS_OUTPUT.PUT_LINE(C.OBJECT_NAME);
            --DBMS_OUTPUT.PUT_LINE('DROP FUNCTION GAEBAL_UPADM.'||C.OBJECT_NAME);
            EXECUTE IMMEDIATE 'DROP FUNCTION GAEBAL_UPADM.'||C.OBJECT_NAME;            
        ELSIF (C.OBJECT_TYPE = 'PROCEDURE') THEN
            DBMS_OUTPUT.PUT_LINE(C.OBJECT_NAME);
            --DBMS_OUTPUT.PUT_LINE('DROP PROCEDURE GAEBAL_UPADM.'||C.OBJECT_NAME);
            EXECUTE IMMEDIATE 'DROP PROCEDURE GAEBAL_UPADM.'||C.OBJECT_NAME;        
        END IF;
    END LOOP;
    FOR D IN (SELECT * FROM USER_OBJECTS WHERE NOT REGEXP_LIKE(OBJECT_NAME, '^SYS') AND NOT REGEXP_LIKE(OBJECT_NAME, '^PK')) LOOP
        DBMS_OUTPUT.PUT_LINE(D.OBJECT_NAME);
        --DBMS_OUTPUT.PUT_LINE('DROP INDEX GAEBAL_UPADM.'||D.OBJECT_NAME||' FORCE');
        EXECUTE IMMEDIATE 'DROP INDEX GAEBAL_UPADM.'||D.OBJECT_NAME||' FORCE';                            
    END LOOP;    
END;
/

REVOKE CONNECT, RESOURCE, DBA FROM G_UPADM;

BEGIN
    FOR C IN (select sid,serial# from v$session where username = 'GAEBAL_UPADM') LOOP
        EXECUTE IMMEDIATE 'ALTER SYSTEM KILL SESSION '''||C.SID||','||C.SERIAL#||''' '; 
    END LOOP;
END;
/

DROP USER GAEBAL_UPADM CASCADE;

DROP TABLESPACE DATA01 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE DATA02 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE DATA03 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE DATA04 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE INDEX01 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE INDEX02 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE INDEX03 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE INDEX04 INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE TS_MWADM INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BIG_IDX INCLUDING CONTENTS AND DATAFILES;
DROP TABLESPACE BIG_DATA INCLUDING CONTENTS AND DATAFILES;


